# ============================================
# APPLICATION CONFIGURATION
# Activiti7 Enterprise Workflow Platform
# ============================================

spring:
  application:
    name: ${SERVICE_NAME:workflow-service}

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  # Database Configuration
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:workflowdb}
    username: ${DB_USERNAME:workflow}
    password: ${DB_PASSWORD:workflow123}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_schema: ${DB_SCHEMA:workflow}

  # Flyway Migration
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  # Redis Cache
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

  # RabbitMQ Messaging
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:workflow}
    password: ${RABBITMQ_PASSWORD:workflow123}

# ============================================
# IDENTITY PROVIDER CONFIGURATION
# Supports: keycloak (OSS), ping (Enterprise)
# ============================================
identity:
  provider: ${IDENTITY_PROVIDER:keycloak}

  keycloak:
    server-url: ${KEYCLOAK_URL:http://localhost:8180}
    realm: ${KEYCLOAK_REALM:workflow}
    client-id: ${KEYCLOAK_CLIENT_ID:workflow-backend}
    client-secret: ${KEYCLOAK_CLIENT_SECRET:}

  # Ping Federation (Enterprise)
  # Enable by setting: IDENTITY_PROVIDER=ping
  ping:
    issuer-url: ${PING_ISSUER_URL:}
    client-id: ${PING_CLIENT_ID:}
    client-secret: ${PING_CLIENT_SECRET:}
    authorization-endpoint: /as/authorization.oauth2
    token-endpoint: /as/token.oauth2
    user-info-endpoint: /idp/userinfo.openid
    jwks-uri: /pf/JWKS
    mfa-enabled: ${PING_MFA_ENABLED:true}

# Spring Security OAuth2 (auto-configured based on identity.provider)
spring.security.oauth2.resourceserver:
  jwt:
    issuer-uri: ${identity.keycloak.server-url}/realms/${identity.keycloak.realm}
    jwk-set-uri: ${identity.keycloak.server-url}/realms/${identity.keycloak.realm}/protocol/openid-connect/certs

# ============================================
# LOGGING & OBSERVABILITY CONFIGURATION
# Supports: opensearch (OSS), splunk (Enterprise)
# ============================================
observability:
  logging:
    backend: ${LOGGING_BACKEND:opensearch}

    # OpenSearch / Elasticsearch (OSS)
    opensearch:
      host: ${OPENSEARCH_HOST:localhost}
      port: ${OPENSEARCH_PORT:9200}
      scheme: ${OPENSEARCH_SCHEME:http}
      username: ${OPENSEARCH_USERNAME:}
      password: ${OPENSEARCH_PASSWORD:}
      index-prefix: workflow
      ssl-enabled: false

    # Splunk (Enterprise)
    # Enable by setting: LOGGING_BACKEND=splunk
    splunk:
      hec-url: ${SPLUNK_HEC_URL:}
      hec-token: ${SPLUNK_HEC_TOKEN:}
      index: ${SPLUNK_INDEX:workflow_events}
      source: workflow-platform
      source-type: _json
      ssl-verify: true
      batch-size: 100
      flush-interval-ms: 5000
      siem-enabled: ${SPLUNK_SIEM_ENABLED:false}
      siem-index: notable

# ============================================
# STORAGE CONFIGURATION
# ============================================
storage:
  type: ${STORAGE_TYPE:minio}
  minio:
    endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
    access-key: ${MINIO_ACCESS_KEY:workflow}
    secret-key: ${MINIO_SECRET_KEY:workflow123}
    bucket:
      documents: documents
      attachments: task-attachments
      forms: forms

# ============================================
# ACTIVITI CONFIGURATION
# ============================================
spring.activiti:
  database-schema-update: true
  history-level: full
  async-executor-activate: true

# ============================================
# SERVER CONFIGURATION
# ============================================
server:
  port: ${SERVER_PORT:8080}
  shutdown: graceful

# ============================================
# ACTUATOR & MONITORING
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# ============================================
# LOGGING
# ============================================
logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    com.enterprise.workflow: ${LOG_LEVEL_APP:DEBUG}
    org.activiti: INFO
    org.springframework.security: INFO

# ============================================
# API DOCUMENTATION
# ============================================
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
